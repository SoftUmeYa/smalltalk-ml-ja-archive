'From Squeak3.9 of 7 November 2006 [latest update: #7067] on 29 October 2007 at 10:31:38 pm'!"Change Set:		Monticello-m17n-patchDate:			29 October 2007Author:			Masashi UmezawaFix: WideString sources are correctly stored."!!MCMczReader methodsFor: 'as yet unclassified' stamp: 'mu 10/29/2007 22:26'!parseMember: fileName	| toReadString tokens |	toReadString := (self zip contentsOf: fileName)				convertFromWithConverter: UTF8TextConverter new.	tokens := (self scanner scanTokens: toReadString) first.	^ self associate: tokens! !!MCMczWriter methodsFor: 'private' stamp: 'mu 10/29/2007 22:20'!sourceStringFrom: rawString 	| responseStream |	responseStream := MultiByteBinaryOrTextStream on: WideString new encoding: #utf8.	UTF8TextConverter writeBOMOn: responseStream.	responseStream nextPutAll: rawString.	responseStream binary.	responseStream reset.	^ responseStream contents! !!MCMczWriter methodsFor: 'visiting' stamp: 'mu 10/29/2007 22:30'!writeSnapshot: aSnapshot	self addSourceString: (self serializeDefinitions: aSnapshot definitions) at: 'snapshot/source.', self snapshotWriterClass extension.	self addString: (self serializeInBinary: aSnapshot) at: 'snapshot.bin'! !!MCMczWriter methodsFor: 'writing' stamp: 'mu 10/29/2007 22:30'!addSourceString: string at: path	self addString: (self sourceStringFrom: string) at: path	! !!MCMczWriter methodsFor: 'writing' stamp: 'stephaneducasse 2/4/2006 20:47'!addString: string at: path	| member |	member := zip addString: string as: path.	member desiredCompressionMethod: ZipArchive compressionDeflated 	! !!MCMcdWriter methodsFor: 'as yet unclassified' stamp: 'mu 10/29/2007 22:30'!writeNewDefinitions: aCollection	self addSourceString: (self serializeDefinitions: aCollection) at: 'new/source.', self snapshotWriterClass extension.! !!MCMcdWriter methodsFor: 'as yet unclassified' stamp: 'mu 10/29/2007 22:30'!writeOldDefinitions: aCollection	self addSourceString: (self serializeDefinitions: aCollection) at: 'old/source.', self snapshotWriterClass extension.! !!MCStReader methodsFor: 'evaluating' stamp: 'mu 1/9/2006 19:22'!readStream	^ ('!!!!', stream contents convertFromWithConverter: UTF8TextConverter new) readStream! !!MCMczWriter reorganize!('accessing' format snapshotWriterClass zip)('initializing' initialize)('serializing' serializeDefinitions: serializeInBinary: serializePackage: serializeVersionInfo:)('private' sourceStringFrom:)('visiting' writeDefinitions: writeFormat writePackage: writeSnapshot: writeVersionDependency: writeVersionInfo: writeVersion:)('writing' addSourceString:at: addString:at: flush)!